<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Inspiration Clock</title>
<style>
  :root { --bg: url("%%IMAGE_URL%%"); }
  html, body { height: 100%; }
  body {
    margin: 0; overflow: hidden; background: #111; color: #fff;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
  }
  body::before {
    content: ""; position: fixed; inset: 0; z-index: 0;
    background-image: var(--bg); background-position: center; background-size: cover;
    filter: blur(24px) brightness(0.9); transform: scale(1.1);
  }
  .wallpaper {
    position: fixed; inset: 0; z-index: 1;
    background-image: var(--bg); background-repeat: no-repeat;
    background-position: center; background-size: contain;
  }

  .clock {
    position: fixed;
    top: 33%;                 /* ~1/3 down the viewport */
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;

    display: inline-block;
    width: min(50vw, var(--img-w, 100vw));  /* half screen but not beyond visible image */
    text-align: center;

    /* remove shaded box */
    background: none;
    backdrop-filter: none;
    border-radius: 0;
    padding: 0;
  }

  #clock-time {
    display: block;
    width: 100%;
    font-variant-numeric: tabular-nums;
    font-weight: 700;
    letter-spacing: .04em;
    line-height: 1.1;
    color: #fff;

    /* text outline */
    text-shadow:
      -3px -3px 0 #000,
       3px -3px 0 #000,
      -3px  3px 0 #000,
       3px  3px 0 #000;

    /* base font scaling — JS fitText will fine-tune */
    font-size: clamp(48px, 8vw, 220px);
  }

  #clock-date {
    display: block;
    margin-top: 0.25em;
    font-weight: 500;
    opacity: 0.9;
    color: #fff;

    /* thinner outline */
    text-shadow:
      -2px -2px 0 #000,
       2px -2px 0 #000,
      -2px  2px 0 #000,
       2px  2px 0 #000;

    font-size: 0.45em; /* relative to time */
  }

  #fs-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 3;

    background: rgba(0,0,0,0.4);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 20px;
    cursor: pointer;

    backdrop-filter: blur(6px);

    opacity: 1;
    transition: opacity 0.5s ease;
  }
  #fs-btn.hidden {
    opacity: 0;
    pointer-events: none; /* avoid accidental clicks when hidden */
  }
</style>
</head>
<body>
  <div class="wallpaper" role="img" aria-label="Inspirational wallpaper"></div>
  <div class="clock">
    <div id="clock-time" style="font-size: 1em;">--:--</div>
    <div id="clock-date" style="font-size: 0.45em; font-weight: 500; opacity: 0.9;">—</div>
  </div>
  <button id="fs-btn" title="Fullscreen">⛶</button>

<script>
  const WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

  function pad2(n){ return String(n).padStart(2,"0"); }

  function tick(){
    const d = new Date();

    // Time (HH:MM AM/PM)
    let hours = d.getHours();
    const minutes = pad2(d.getMinutes());
    const ampm = hours >= 12 ? "PM" : "AM";
    hours = hours % 12;
    if (hours === 0) hours = 12;
    document.getElementById("clock-time").textContent = `${hours}:${minutes} ${ampm}`;

    // Date (Weekday, Mon DD)
    const weekday = WEEKDAYS[d.getDay()];
    const mon = MONTHS[d.getMonth()];
    const day = d.getDate();
    document.getElementById("clock-date").textContent = `${weekday}, ${mon} ${day}`;
  }

  function scheduleMidnightReload() {
    const now = new Date();
    const msUntilMidnight = new Date(
      now.getFullYear(), now.getMonth(), now.getDate()+1, 0, 0, 5
    ) - now;
    setTimeout(() => location.reload(true), msUntilMidnight);
  }

  tick();
  setInterval(tick, 15 * 1000);
  scheduleMidnightReload();

  // --- Wake Lock to prevent screen sleep ---
  let wakeLock = null;
  async function requestWakeLock() {
    try {
      if ('wakeLock' in navigator) {
        wakeLock = await navigator.wakeLock.request('screen');
        console.log("[WakeLock] Screen lock acquired");
        wakeLock.addEventListener('release', () => {
          console.log('[WakeLock] Screen lock released');
        });
      } else {
        console.log("[WakeLock] API not supported in this browser");
      }
    } catch (err) {
      console.error(`[WakeLock] Error: ${err.name}, ${err.message}`);
    }
  }
  requestWakeLock();

  // Re-request on visibility change
  document.addEventListener('visibilitychange', () => {
    if (wakeLock !== null && document.visibilityState === 'visible') {
      requestWakeLock();
    }
  }); // <-- was missing

  // --- Fullscreen toggle ---
  const fsBtn = document.getElementById("fs-btn");

  async function toggleFullscreen() {
    if (!document.fullscreenElement) {
      try {
        await document.documentElement.requestFullscreen();
        fsBtn.textContent = "⤫";
      } catch (err) {
        console.error("[Fullscreen] Error:", err);
      }
    } else {
      try {
        await document.exitFullscreen();
        fsBtn.textContent = "⛶";
      } catch (err) {
        console.error("[Fullscreen] Error:", err);
      }
    }
  }
  fsBtn.addEventListener("click", toggleFullscreen);

  // Update button icon when user exits via Esc
  document.addEventListener("fullscreenchange", () => {
    if (!document.fullscreenElement) {
      fsBtn.textContent = "⛶";
    }
  }); // <-- was missing

  // --- Auto-hide fullscreen button after inactivity ---
  let hideTimeout;
  function showButton() {
    const btn = document.getElementById("fs-btn");
    btn.classList.remove("hidden");
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(() => {
      btn.classList.add("hidden");
    }, 3000);
  }

  ["mousemove","keydown","touchstart"].forEach(evt => {
    document.addEventListener(evt, showButton);
  });

  // Start hidden on load
  document.getElementById("fs-btn").classList.add("hidden");
</script>

</body>
</html>
